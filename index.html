<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Sri Surya S. Vaddhiparthy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="assets/css/profile-assistant.css">
</head>
<body>
  <div class="layout">
    <!-- LEFT SIDEBAR -->
    <aside class="sidebar">
      <div class="sidebar-inner">
        <!-- Static avatar (from data/display_picture.jpg) -->
        <div class="avatar">
          <div class="avatar-circle">
            <img id="avatar-img" src="" alt="">
          </div>
        </div>

        <h1 class="name" id="sidebar-name"></h1>
        <p class="headline" id="sidebar-headline"></p>
        <p class="degree" id="sidebar-degree"></p>

        <ul class="meta">
          <!-- Location -->
          <li>
            <span class="icon">
              <!-- Location Pin (Minimal, Black) -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 10c0 7-9 13-9 13S3 17 3 10a9 9 0 1 1 18 0z"></path>
                <circle cx="12" cy="10" r="3"></circle>
              </svg>
            </span>
            <span id="sidebar-location"></span>
          </li>

          <!-- Employer -->
          <li>
            <span class="icon">
              <!-- Briefcase Icon (Black & Minimal) -->
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="black" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 3H8a2 2 0 0 0-2 2v2h12V5a2 2 0 0 0-2-2z"></path>
              </svg>
            </span>
            <span id="sidebar-employer"></span>
          </li>
        </ul>

        <!-- Navigation -->
        <div class="nav-block">
          <div class="nav-title">Main</div>
          <ul class="sidebar-links" id="nav-main"></ul>
        </div>

        <div class="nav-block">
          <div class="nav-title">Profiles &amp; Contact</div>
          <ul class="sidebar-links" id="nav-profiles"></ul>
        </div>
                <!-- Sidebar AI Assistant -->
        <section id="assistant" class="section">
          <h2> Meet Surya’s AI Twin</h2>
          <p>
             An always-on AI version of Surya, grounded in his Information. 
             The service cold-starts, so the first answer might take up to 60 seconds.
          </p>

          <!-- CHATBOX MOUNT -->
          <div id="chatbot-root"></div>
        </section>

      </div>
    </aside>

    <!-- RIGHT SIDE -->
    <div class="main-column">
      <!-- TOP BAR WITH HAMBURGER -->
      <header class="topbar">
        <div class="topbar-title">
          <span class="topbar-name" id="topbar-name"></span>
          <span class="topbar-sub" id="topbar-sub"></span>
        </div>

        <button class="hamburger" aria-label="Toggle navigation" aria-expanded="false">
          <span></span><span></span><span></span>
        </button>

        <nav class="hamburger-menu" id="hamburger-menu">
          <a href="#summary">Summary</a>
          <a href="#research-interests">Research</a>
          <a href="#projects">Projects</a>
          <a href="#contact">Contact</a>
        </nav>
      </header>

      <!-- CONTENT CARD -->
      <main class="content">
        <!-- Professional Summary -->
        <section id="summary" class="section">
          <h2 id="summary-title"></h2>
          <div id="summary-body"></div>
        </section>

        <!-- Chat Mount Point (UI already implemented elsewhere) -->
        <section id="chat-section" class="section">
          <h2 id="chat-title"></h2>
          <p id="chat-description"></p>
          <div id="chat-mount"></div>
        </section>

        <!-- Research Interests -->
        <section id="research-interests" class="section">
          <h2 id="research-title"></h2>
          <ul id="research-list"></ul>
        </section>

        <!-- Projects -->
        <section id="projects" class="section">
          <h2 id="projects-title"></h2>
          <div id="projects-list"></div>
        </section>

        <!-- Contact -->
        <section id="contact" class="section">
          <h2 id="contact-title"></h2>
          <div id="contact-body"></div>
        </section>

        <!-- Chatbot landing zone -->
        <section id="assistant" class="section">
          <h2 id="assistant-title"></h2>
          <div id="chatbot-root"></div>
          <p id="assistant-description"></p>
        </section>

        <footer class="footer">
          <span id="footer-text"></span>
          <span id="year"></span>
        </footer>
      </main>
    </div>
  </div>

  <!-- Content loader (fills everything from data/site-content.json) -->
  <script src="assets/js/site-content-loader.js"></script>

  <!-- Existing profile assistant UI JS (unchanged) -->
  <script src="assets/js/profile-assistant.js"></script>

  <script>
    // Hamburger menu logic (unchanged)
    const hamBtn = document.querySelector('.hamburger');
    const hamMenu = document.getElementById('hamburger-menu');

    if (hamBtn && hamMenu) {
      hamBtn.addEventListener('click', () => {
        const open = hamMenu.classList.toggle('open');
        hamBtn.setAttribute('aria-expanded', open ? 'true' : 'false');
      });

      hamMenu.querySelectorAll('a').forEach(a => {
        a.addEventListener('click', () => {
          hamMenu.classList.remove('open');
          hamBtn.setAttribute('aria-expanded', 'false');
        });
      });
    }
  </script>

    <!-- JSON → DOM loader -->
  <script src="assets/js/site-content-loader.js"></script>

  <!-- Pepper chat script (hard-coded, same behaviour as old site) -->
  <script>
  (function () {
    const API_BASE = "https://pepper-portfolio.onrender.com";  // no trailing slash
    const CHAT_ENDPOINT = "/api/chat";

    function initPepperChat(mountId) {
      const root = document.getElementById(mountId);
      if (!root) return;

      root.innerHTML = `
        <div class="chat-card">
          <div class="chat-header">
            <div class="chat-orb state-idle" id="pepper-orb"></div>
            <div>
              <div class="chat-title-main"> Surya </div>
              <div class="chat-title-sub">AI Twin · © 2025</div>
            </div>
          </div>
          <div class="chat-messages" id="pepper-messages"></div>
          <form class="chat-input-row" id="pepper-form">
            <textarea
              id="pepper-input"
              rows="1"
              placeholder="Ask here"></textarea>
            <button type="submit">Send</button>
          </form>
        </div>
      `;

      const messagesEl = root.querySelector("#pepper-messages");
      const formEl     = root.querySelector("#pepper-form");
      const inputEl    = root.querySelector("#pepper-input");
      const orbEl      = root.querySelector("#pepper-orb");

      let sending = false;
      const sessionId = crypto.randomUUID ? crypto.randomUUID() : String(Date.now());

      function scrollToBottom() {
        messagesEl.scrollTop = messagesEl.scrollHeight;
      }

      function setOrbState(state) {
        orbEl.classList.remove("state-idle", "state-typing", "state-error");
        orbEl.classList.add(state);
      }

      function addMessage(role, text, metaText) {
        const row = document.createElement("div");
        row.className = `message-row ${role}`;

        const bubble = document.createElement("div");
        bubble.className = `message-bubble ${role}`;
        bubble.textContent = text;

        if (metaText) {
          const meta = document.createElement("div");
          meta.className = "message-meta";
          meta.textContent = metaText;
          bubble.appendChild(meta);
        }

        row.appendChild(bubble);
        messagesEl.appendChild(row);
        scrollToBottom();
        return bubble;
      }

      async function sendMessage(text) {
        if (!text.trim() || sending) return;
        sending = true;

        // User bubble with single tick initially
        const userBubble = addMessage("user", text, "✓ sent");
        const metaEl = userBubble.querySelector(".message-meta");

        inputEl.value = "";
        inputEl.focus();
        setOrbState("state-typing");

        try {
          metaEl.textContent = "✓✓ delivered";

          const resp = await fetch(API_BASE + CHAT_ENDPOINT, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              message: text
            })
          });

          if (!resp.ok) {
            throw new Error("HTTP " + resp.status);
          }

          const data = await resp.json();
          const reply = data.reply || data.message || "I had trouble forming a reply, but the backend responded.";

          addMessage("assistant", reply);
        } catch (err) {
          console.error(err);
          metaEl.textContent = "✓✓ (error)";
          setOrbState("state-error");
          addMessage("assistant", "Sorry, something went wrong talking to my backend.");
        } finally {
          sending = false;
          setOrbState("state-idle");
        }
      }

      formEl.addEventListener("submit", function (e) {
        e.preventDefault();
        sendMessage(inputEl.value);
      });

      // Enter to send, Shift+Enter for newline
      inputEl.addEventListener("keydown", function (e) {
        if (e.key === "Enter" && !e.shiftKey) {
          e.preventDefault();
          formEl.dispatchEvent(new Event("submit"));
        }
      });

      // Optional: initial system message
      addMessage(
        "assistant",
        "Hi, I’m Surya. Ask me about my projects, stack, or how I’d approach your problem."
      );
    }

    document.addEventListener("DOMContentLoaded", function () {
      initPepperChat("chatbot-root");
    });
  })();
  </script>
</body>
</html>

</body>
</html>
